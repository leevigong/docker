## 워드프레스 사이트 시스템 구성 및 데이터 흐름
<img src="https://hull.kr/data/editor/2410/20241018200212_4536f0e37b95d727ccf5a11734363655_qfsu.png">

1. 윈도우(호스트) = 가상 NAT 라우터 (게이트 웨이 IP: 192.168.135.1)
   - 역할 : VMware의 NAT 라우터로 외부 네트워크와 내부 네트워크 간 IP 변환(NAT)를 수행
   - 기능: 외부에서 들어오는 요청을 가상 네트워크로 전달하고, 내부 네트워크에서 나가는 트래픽을 외부 네트워크로 변환하여 전달
   - 입력 포트 IP: 172.25.80.1 (윈도우 랜카드의 IP)
   - 출력 포트 IP: 192.168.135.1 (VMware 내부 네트워크의 게이트웨이 IP)
2. 가상 스위치
   - 역할: 윈도우(호스트)와 우분투(게스트) 간의 네트워크 트래픽을 스위칭
   - 기능: VMware 내부에서 호스트와 게스트 간의 패킷을 MAC 주소 기반으로 전달하며, 물리적 스위치처럼 작동
3. 우분투(게스트)
   - 역할: Docker 네트워크 내부의 NAT 라우터로, 내부 컨테이너 간 패킷 라우팅을 수행하고, IP 변환을 통해 외부와 통신
   - 입력 포트 IP: 192.168.135.130 (VMware 우분투 IP)
   - 출력 포트 IP: 172.18.0.1 (Docker 가상 네트워크의 게이트웨이 IP)
   - NAT 기능: 내부 IP를 외부에 숨기고, 외부에서 들어오는 트래픽을 내부 적절한 IP로 전달
   - 포트포워드(Port Forword) 기능
      - NAT 기능의 일부
      - 외부 특정 포트로 들어오는 트래픽을 내부의 특정 IP와 포트로 전달
      - `docker run --name wordpress000ex12 -dit --net=wordpress000net1 -p 8085:80 ...`  
        : 8085 포트의 패킷을 -> wordpress000ex12:80으로 즉 결정된 IP와포트(172.18.0.3:80)로 패킷을 전달한다
4. 가상 스위치(Docker 네트워크 내)
    - 역할: Docker 네트워크 내부에서 컨테이너 간 패킷을 전달하는 스위치 역할
    - 기능: Docker 네트워크 내에서 각 컨테이너 간의 트래픽을 관리하고 MAC 주소를 기반으로 전달
5. 워드프레스 컨테이너(IP: 172.18.0.3)
    - 역할: 웹 애플리케이션 제공 컨테이너로, Docker 네트워크에서 실행
    - 기능: 웹 요청을 처리하고, 데이터베이스와 통신
6. MySQL 컨테이너(IP: 172.18.0.4)
    - 역할: 데이터베이스 제공 컨테이너로, 워드프레스 컨테이너와 통신
    - 기능: 데이터 저장 및 조회 작업을 처리
  
---
## IPv4 address
IPv4 : 일반적으로 점으로 구분된 10진수로 표시된 주소(사람이 쉽게 읽기위해) ex) 209.165.200.225  
** 내부적으로 4개의 8bit 옥텟으로 나누어진 32개(4개의 8비트 옥텟)의 2진수 비트로 표현 ex)11010001.10100101.11001000.11100001
- 계층적이다
- 네트워크 부분 + 호스트 부분으로 구성
** 동일한 네트워크의 모든 장치들은 동일한 네트워크 부분을 갖는다
- 3개의 IPv4 주소를 구성해야한다
  - 호스트 고유 ip 주소
  - 서브넷 마스크: ip주소 네크워크/호스트 식별
  - 게이트웨이: 로컬 **라우터** 인터페이스 IP주소

#### 서브넷 마스크
장치가 네트워크 부분과 호스트 부분을 식별하는데 도움을 줌
- 네트워크 부분 모두 1, 호스트 부분 모두 0 -> IP 주소와 AND 연산 => 자기 IP주소
- 자기 네트워크 IP를 알게해줌 + 나머지 부분으로 호스트도 알게 해줌
- 얼마나 많은 IP를 할당 받을 수 있는가? 는 호스트 부분이 결정
ex) 192.168.10.0/24
- 네트워크 부분 192.168.10 - 고정
- 남는 호스트 부분 8비트이므로 0-255(0~$2^n$-1) 에서 0: 네트워크 ip, 255: 브로드캐스트 ip빼고 254개(256-2)

#### DHCP(Dynamic Host Configuration Protocol): 네트워크에 연결된 장치에 자동으로 IP 주소를 할당
- DHCP 서버를 통해 IPv4 주소를 동적으로 할당받음
- 따라서 네트워크 관리자가 매번 수동으로 IP 주소를 설정하지 않아도 되는 편리함을 제공.
  - 초기 장치가 네트워크에 연결되면 MAC주소만 존재 (IP주소 없음)
  - IP주소를 할당받아야 외부와 통신이 가능하므로 브로드캐스트로 DHCP서버에 접근하여 IP주소를 부여 받음  
  ** 고정 IP없이 필요할때마다 DHCP에게 동적으로 할당 받음

---
## Switch
- Layer2 Switch: 포트별로 Collision donmain(충돌 도메인)을 나눈다  
** Collision donmain(충돌 도메인): 전송매체 공유하고 이는 여러 단말들이 서로 경쟁하여 충돌이 발생할 수 있는 영역(= 허브의 단점)으로 이를 해결하기 위해 Switch 개발
- 하나의 Broadcast Domain에 속해있다  
** Broadcast Domain: LAN상 어떤 단말이 브로드캐스트 패킷을 송출할 때, 이 패킷에 대해 네트워크에 영향을 받는 영역 or 그 패킷을 수신할 수 있는 단말들의 집합

#### 스위치 종류
- Layer1: 허브, 리피터 -> 패킷관리 x
- Layer2: 데이터 링크계층에서 작동하는 네트워크 브릿지. 각각의 연결된 디바이스의 MAC 주소 저장. 이 MAC을 이용해 포트 스위칭
- Layer3: Layer2의 기능에 더해, 통상적인 라우터들이 수행하는 기능의 일부 혹은 전부 수행가능
- Layer4, 7: 네트워크 주소 변환을 위한 기능 + TCP 세션 기반의 부하 분산 등의 추가적인 기능. 네트워크 서비스 x / 서버(클라우드, 포스팅) 서비스

#### 라우터와 차이점
| 항목                   | 스위치                   | 라우터                  |
|------------------------|--------------------------|-------------------------|
| 데이터 전송 범위        | 같은 네트워크 내부        | 네트워크 사이           |
| 전송을 위해 이용하는 테이블 | MAC 주소 테이블           | 라우팅 테이블, ARP 테이블            |
| 전송 참조 주소          | MAC 주소                  | IP 주소                 |
| 테이블에 필요한 정보가 없을 때 동작 | 데이터 flooding(브로드캐스트) | 데이터 파기              |

#### 스위치 기능
Switch가 수신한 Ethernet Frame을 참조하여 MAC 주소 테이블을 생성 및 갱신하고 목적지로 전송할때 사용하는 프로토콜
일반 3 기능   
• 주소 학습 기능 (Learning)   
• 프레임 전달 및 필터링 기능 (Forwarding / Filtering)    
• 루프(Loop) 회피 기능     
   - 통신망의 신뢰성 제공을 위해 이중화 구조(Redundant Topology)를 사용
   - STP(Spanning-tree Protocol) 기능으로 Link 이중화 및 Loop 방지 가능

** 데이터가 중계되는 과정에서 브리지가 실질적으로 네트워크에 드러나지 않기 때문에 “투명(Transparent)” 용어 사용됨

#### Transparent Bridging
0) 초기 상태 : MAC 테이블 비워져 있음
1) Learning, Flooding
   - Learning: A가 C에게 프레임을 보낼때 스위치는 A의 인터페이스 번호, MAC 주소 저장
   - Flooding: 스위치는 C에 MAC을 모르기 때문에 모드 인터페이스로 프레임을 전송   
2) Forwarding, Filtering
   - Forwarding: A가 C에게 프레임을 보낼때 스위치는 C의 MAC을 알고 있음. 따라서 E2로 프레임을 전송함
   - Filtering: E1, E2에는 프레임을 전송하지 않음
3) Flooding, Filtering
   - Flooding: D가 멀티캐스트 or 브로드캐스트 프레임을 보내려고함 -> 스위치는 모든 인터페이스 포트에 프레임을 복사하여 전송
   - Filtering: 프레임을 최초 송신한 E3 인터페이스 포트에는 프레임을 전송하지않음(자기자신이므로)
4) Aging
   - 스위치는 저장된 MAC 주소에서 통신하지 않은 디바이스의 MAC 주소를300초가 지나면 삭제
   - 300초 동안 디바이스가 다시 통신하면 300초로 리셋
<img src="https://github.com/user-attachments/assets/878dd974-24da-43ac-b778-69c2a464b41e" width=500>

---
## 라우터와 라우팅
- 라우터: 라우팅 테이블을 이용해 서로 다른 브로드 캐스트 여역간에 패킬을 전달하는 네트워크 핵심 장치
- 라우팅: 정적/동적 라우팅 프로토콜 기반으로 최적 경로 선택 및 패킷 전달하는 행위

